<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý - Sport Store</title>
    <link href="vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
    <link href="css/sb-admin-2.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,700,900" rel="stylesheet">
    <style>
        .badge-success {
            background-color: #1cc88a;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
        }
        .badge-danger {
            background-color: #e74a3b;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 13px;
        }
    </style>
</head>
<body id="page-top">
<div id="wrapper">
    <!-- Sidebar -->
    <ul class="navbar-nav sidebar sidebar-dark accordion" id="accordionSidebar" style="background-color: #e7de69;">
        <a class="sidebar-brand d-flex align-items-center justify-content-center" href="#">
            <div class="sidebar-brand-icon rotate-n-15">
                <i class="fas fa-laugh-wink"></i>
            </div>
            <div class="sidebar-brand-text mx-3">Sport Store</div>
        </a>
        <hr class="sidebar-divider my-0">
        <li class="nav-item active">
            <a class="nav-link" href="#" id="nav-dashboard">
                <i class="fas fa-fw fa-tachometer-alt"></i>
                <span>Dashboard</span>
            </a>
        </li>
        <hr class="sidebar-divider">
        <div class="sidebar-heading">INTERFACE</div>
        <li class="nav-item">
            <a class="nav-link" href="#" id="nav-nhapkho">
                <i class="fas fa-boxes"></i>
                <span>Nhập kho</span>
            </a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="#" id="nav-sanpham">
                <i class="fas fa-dumbbell"></i>
                <span>Sản phẩm</span>
            </a>
        </li>
    </ul>

    <!-- Content -->
    <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
            <!-- Topbar -->
            <nav class="navbar navbar-expand navbar-light bg-white topbar mb-4 static-top shadow">
                <ul class="navbar-nav ml-auto">
                    <li class="nav-item dropdown no-arrow mx-1">
                        <a class="nav-link dropdown-toggle" href="#">
                            <i class="fas fa-bell fa-fw"></i>
                            <span class="badge badge-danger badge-counter">3+</span>
                        </a>
                    </li>
                    <li class="nav-item dropdown no-arrow mx-1">
                        <a class="nav-link dropdown-toggle" href="#">
                            <i class="fas fa-envelope fa-fw"></i>
                            <span class="badge badge-danger badge-counter">7</span>
                        </a>
                    </li>
                    <div class="topbar-divider d-none d-sm-block"></div>
                    <li class="nav-item dropdown no-arrow">
                        <a class="nav-link dropdown-toggle" href="#">
                            <span class="mr-2 d-none d-lg-inline text-gray-600 small">Douglas McGee</span>
                            <img class="img-profile rounded-circle" src="img/undraw_profile.svg">
                        </a>
                    </li>
                </ul>
            </nav>

            <!-- Dashboard -->
            <div class="container-fluid main-content" id="dashboard-content">
                <h1 class="h3 mb-4 text-gray-800">Dashboard</h1>
                <p>Welcome to the dashboard.</p>
            </div>

            <!-- Nhập kho -->
            <div class="container-fluid main-content" id="nhapkho-content" style="display: none;">
                <h1 class="h4 mb-4 text-primary font-weight-bold">Danh sách phiếu nhập</h1>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <input type="text" id="search-keyword" class="form-control" placeholder="Tìm phiếu nhập theo mã, tên NCC...">
                    </div>
                    <div class="col-md-2"><button class="btn btn-primary" onclick="searchBill()">Tìm kiếm</button></div>
                    <button class="btn btn-info" id="addBillBtn" data-toggle="modal" data-target="#addBillModal">
                        Thêm Sản Phẩm Mới
                    </button>

                </div>
                <div class="card shadow mb-3">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered m-0">
                                <thead class="thead-light">
                                <tr>
                                    <th>Mã hóa đơn</th>
                                    <th>Nhà cung cấp</th>
                                    <th>Số điện thoại</th>
                                    <th>Địa chỉ</th>
                                    <th>Ngày nhập</th>
                                    <th>Trạng thái</th>
                                    <th>Tổng tiền</th>
                                    <th>Chi tiết</th>
                                </tr>
                                </thead>
                                <tbody id="bill-supply-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
                <div class="p-3 bg-light border rounded">
                    Tổng hóa đơn: <span id="total-bills" class="text-danger font-weight-bold">0</span>
                    &nbsp;&nbsp; Tổng tiền: <span id="total-cost" class="text-danger font-weight-bold">0 đ</span>
                    &nbsp;&nbsp; Tổng nợ: <span class="text-danger font-weight-bold">0 đ</span>
                </div>
            </div>

            <div class="card shadow mt-4 mb-4" id="bill-detail-section" style="display: none;">
                <div class="card-header">
                    <strong>Chi tiết phiếu nhập</strong> - <span id="selected-bill-id"></span>
                </div>
                <div class="row mb-3">
                    <div class="col-md-4">
                        <input type="text" id="search-bill-detail" class="form-control" placeholder="Tìm phiếu nhập theo mã, tên NCC...">
                    </div>
                    <div class="col-md-2"><button class="btn btn-primary" onclick="searchDetailBill()">Tìm kiếm</button></div>
                    <button class="btn btn-info" id="addDetailBillBtn" data-toggle="modal" data-target="#addBillDetailModal">
                        Thêm Sản Phẩm Mới
                    </button>

                </div>
                <div class="card-body">
                    <table class="table table-bordered">
                        <thead>
                        <tr>
                            <th>Mã</th>
                            <th>Tên sản phẩm</th>
                            <th>Phân loại</th>
                            <th>Số lượng</th>
                            <th>Đơn giá</th>
                            <th>Thành tiền</th>
                        </tr>
                        </thead>
                        <tbody id="bill-detail-body"></tbody>
                    </table>
                </div>
            </div>

            <!-- Modal Thêm Hóa Đơn Nhập -->
            <div class="modal fade" id="addBillModal" tabindex="-1" role="dialog" aria-labelledby="addBillModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header bg-info text-white">
                            <h5 class="modal-title">Thêm phiếu nhập</h5>
                            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Đóng">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="bill-form">
                                <div class="form-group">
                                    <label>Mã hóa đơn</label>
                                    <input type="text" id="bill_id" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Nhà cung cấp</label>
                                    <input type="text" id="supplier_name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Số điện thoại</label>
                                    <input type="text" id="supplier_phone" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Địa chỉ</label>
                                    <input type="text" id="supplier_address" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Ngày nhập</label>
                                    <input type="date" id="bill_date" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Tổng tiền</label>
                                    <input type="number" id="bill_cost" class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-info">Lưu</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Thêm Chi Tiết Hóa Đơn -->
            <div class="modal fade" id="addBillDetailModal" tabindex="-1" role="dialog" aria-labelledby="addBillDetailModalLabel" aria-hidden="true">
                <div class="modal-dialog" role="document">
                    <div class="modal-content">
                        <div class="modal-header bg-info text-white">
                            <h5 class="modal-title">Thêm chi tiết hóa đơn</h5>
                            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Đóng">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="bill-detail-form">
                                <div class="form-group">
                                    <label>Tên sản phẩm</label>
                                    <input type="text" id="detail_product_name" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Phân loại</label>
                                    <input type="text" id="detail_option_id" class="form-control">
                                </div>
                                <div class="form-group">
                                    <label>Số lượng</label>
                                    <input type="number" id="detail_quantity" class="form-control" required>
                                </div>
                                <div class="form-group">
                                    <label>Đơn giá</label>
                                    <input type="number" id="detail_cost" class="form-control" required>
                                </div>
                                <button type="submit" class="btn btn-info">Lưu</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Sản phẩm -->
            <div class="container-fluid main-content" id="sanpham-content" style="display: none;">
                <h1 class="h4 mb-4 text-success font-weight-bold">Danh sách sản phẩm</h1>

                <!-- Thanh tìm kiếm và thêm sản phẩm -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="search-product-keyword" placeholder="Tìm theo mã hoặc tên sản phẩm...">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary" onclick="searchProduct()">Tìm kiếm</button>
                    </div>
                    <button class="btn btn-info" id="addProductBtn" data-toggle="modal" data-target="#addProductModal">
                        Thêm Sản Phẩm Mới
                    </button>
                </div>

                <!-- Danh sách sản phẩm -->
                <div class="card shadow mb-4">
                    <div class="card-body p-0">
                        <div class="table-responsive">
                            <table class="table table-bordered m-0">
                                <thead class="thead-light">
                                <tr>
                                    <th>Mã SP</th>
                                    <th>Tên sản phẩm</th>
                                    <th>Loại</th>
                                    <th>Thương hiệu</th>
                                    <th>Giảm giá</th>
                                    <th>Trạng thái</th>
                                    <th>Mô tả</th>
                                </tr>
                                </thead>
                                <tbody id="product-list"></tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Thêm Sản Phẩm -->
            <div class="modal fade" id="addProductModal" tabindex="-1" role="dialog" aria-labelledby="addProductModalLabel" aria-hidden="true">
                <div class="modal-dialog modal-lg" role="document">
                    <div class="modal-content">
                        <div class="modal-header bg-primary text-white">
                            <h5 class="modal-title" id="addProductModalLabel">Thêm sản phẩm mới</h5>
                            <button type="button" class="close text-white" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <form id="product-form">
                                <div class="form-group">
                                    <label>Mã sản phẩm</label>
                                    <input type="text" class="form-control" id="product_id" required>
                                </div>
                                <div class="form-group">
                                    <label>Tên sản phẩm</label>
                                    <input type="text" class="form-control" id="product_name" required>
                                </div>
                                <div class="form-group">
                                    <label>Mô tả sản phẩm</label>
                                    <textarea class="form-control" id="product_detail" rows="3"></textarea>
                                </div>
                                <div class="form-row">
                                    <div class="form-group col-md-4">
                                        <label>Loại sản phẩm</label>
                                        <div class="input-group">
                                            <select id="category_id" class="form-control" onchange="handleAddOption('category')"></select>
                                            <div class="input-group-append">
                                                <button class="btn btn-danger" type="button" onclick="deleteSelectedOption('category_id')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>Thương hiệu</label>
                                        <div class="input-group">
                                            <select id="brand_id" class="form-control" onchange="handleAddOption('brand')"></select>
                                            <div class="input-group-append">
                                                <button class="btn btn-danger" type="button" onclick="deleteSelectedOption('brand_id')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group col-md-4">
                                        <label>Giảm giá</label>
                                        <div class="input-group">
                                            <select id="discount_id" class="form-control" onchange="handleAddOption('discount')"></select>
                                            <div class="input-group-append">
                                                <button class="btn btn-danger" type="button" onclick="deleteSelectedOption('discount_id')">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="form-check mb-3">
                                    <input class="form-check-input" type="checkbox" id="is_active" checked>
                                    <label class="form-check-label">Đang bán</label>
                                </div>
                                <button type="submit" class="btn btn-success">Lưu sản phẩm</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Modal Thêm Thương Hiệu -->
            <div class="modal fade" id="addBrandModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="brand-form">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title">Thêm thương hiệu</h5>
                                <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Tên thương hiệu</label>
                                    <input type="text" class="form-control" id="new_brand_name" required>
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-info">Lưu</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>


            <!-- Modal Thêm Loại Sản Phẩm -->
            <div class="modal fade" id="addCategoryModal" tabindex="-1">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <form id="category-form">
                            <div class="modal-header bg-info text-white">
                                <h5 class="modal-title">Thêm loại sản phẩm</h5>
                                <button type="button" class="close text-white" data-dismiss="modal">&times;</button>
                            </div>
                            <div class="modal-body">
                                <div class="form-group">
                                    <label>Tên loại</label>
                                    <input type="text" class="form-control" id="new_category_name" required>
                                </div>
                                <div class="form-group">
                                    <label>Hình ảnh</label>
                                    <input type="file" class="form-control-file" id="new_category_image" accept="image/*">
                                </div>
                            </div>
                            <div class="modal-footer">
                                <button type="submit" class="btn btn-info">Lưu</button>
                            </div>
                        </form>
                    </div>
                </div>
            </div>




            <!-- Danh sách mẫu sản phẩm -->
            <div class="container-fluid main-content" id="product-option-content" style="display: none;">
                <h1 class="h4 mb-4 text-primary font-weight-bold">Danh sách Mẫu Sản Phẩm</h1>

                <!-- Thanh tìm kiếm và thêm sản phẩm -->
                <div class="row mb-3">
                    <div class="col-md-6">
                        <input type="text" class="form-control" id="search-product_option-keyword" placeholder="Tìm theo mã hoặc tên sản phẩm...">
                    </div>
                    <div class="col-md-2">
                        <button class="btn btn-primary" onclick="searchProductOption()">Tìm kiếm</button>
                    </div>
                    <button class="btn btn-info" id="addOptionBtn" data-toggle="modal" data-target="#addOptionModal">
                        Thêm Mẫu Sản Phẩm Mới
                    </button>
                </div>

                <table class="table table-bordered" id="productOptionTable">
                    <thead class="thead-light">
                    <tr>
                        <th>Option ID</th>
                        <th>Màu</th>
                        <th>Kích thước</th>
                        <th>Số lượng</th>
                        <th>Giá</th>
                        <th>Giảm giá</th>
                        <th>Hình ảnh</th>
                        <th>Kích hoạt</th>
                    </tr>
                    </thead>
                    <tbody>
                    <!-- Nội dung sẽ được thêm bằng JavaScript -->
                    </tbody>
                </table>

                <!-- Modal Thêm Mẫu Sản Phẩm Mới -->
                <div class="modal fade" id="addOptionModal" tabindex="-1" role="dialog" aria-labelledby="addOptionModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header bg-warning text-white">
                                <h5 class="modal-title" id="addOptionModalLabel">Thêm Mẫu Sản Phẩm Mới</h5>
                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Đóng">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <form id="productOptionForm">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label>Option ID</label>
                                        <input type="text" id="newOptionId" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Màu (Color)</label>
                                        <div class="input-group">
                                            <select id="newOptionColor" class="form-control" required>
                                                <option value="1">Đỏ</option>
                                                <option value="2">Xanh</option>
                                                <option value="3">Trắng</option>
                                                <option value="add_new">➕ Thêm màu mới</option>
                                            </select>
                                            <div class="input-group-append">
                                                <button class="btn btn-danger" type="button" onclick="deleteSelectedColor()">
                                                    <i class="fas fa-trash"></i>
                                                </button>
                                                <button class="btn btn-outline-secondary" type="button" onclick="openAddColorModal()">
                                                    <i class="fas fa-plus"></i>
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="form-group">
                                        <label>Kích thước (Size)</label>
                                        <input type="text" id="newOptionSize" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Số lượng</label>
                                        <input type="number" id="newOptionQuantity" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Giá (Cost)</label>
                                        <input type="number" id="newOptionPrice" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Giảm giá (Discount)</label>
                                        <select id="newOptionDiscountId" class="form-control">
                                            <option value="">Không áp dụng</option>
                                            <option value="1">Giảm 10%</option>
                                            <option value="2">Giảm 20%</option>
                                            <option value="3">Giảm 50%</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label>Hình ảnh</label>
                                        <input type="file" class="form-control-file" id="newOptionImage" accept="image/*" multiple>
                                    </div>
                                    <!-- Khung hiển thị hình ảnh đã chọn -->
                                    <div id="imagePreview" class="mt-2 d-flex flex-wrap gap-2"></div>

                                    <div class="form-check mb-3">
                                        <input class="form-check-input" type="checkbox" id="newOptionIsActive" checked>
                                        <label class="form-check-label">Kích hoạt</label>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-info">Lưu Mẫu Sản Phẩm</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>

                <!-- Modal Thêm Màu Mới -->
                <div class="modal fade" id="addColorModal" tabindex="-1" role="dialog" aria-labelledby="addColorModalLabel" aria-hidden="true">
                    <div class="modal-dialog" role="document">
                        <div class="modal-content">
                            <div class="modal-header bg-primary text-white">
                                <h5 class="modal-title">Thêm Màu Mới</h5>
                                <button type="button" class="close text-white" data-dismiss="modal" aria-label="Đóng">
                                    <span aria-hidden="true">&times;</span>
                                </button>
                            </div>
                            <form id="addColorForm">
                                <div class="modal-body">
                                    <div class="form-group">
                                        <label>Mã màu (ID)</label>
                                        <input type="text" id="newColorId" class="form-control" required>
                                    </div>
                                    <div class="form-group">
                                        <label>Tên màu</label>
                                        <input type="text" id="newColorName" class="form-control" required>
                                    </div>
                                </div>
                                <div class="modal-footer">
                                    <button type="submit" class="btn btn-primary">Lưu màu</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>







                <!-- Form thêm sản phẩm -->

                <!-- Form thêm sản phẩm -->


                <!-- Modal Danh sách mẫu sản phẩm -->




                <!-- Scripts -->
                <script src="vendor/jquery/jquery.min.js"></script>
                <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
                <script src="vendor/jquery-easing/jquery.easing.min.js"></script>
                <script src="js/sb-admin-2.min.js"></script>
                <script>
                    const bills = [
                        {
                            bill_supply_id: "PN001",
                            supplier_name: "Công ty A",
                            supplier_phone: "0909123456",
                            supplier_address: "123 Lê Lợi",
                            bill_supply_date: "2024-12-01",
                            bill_supply_cost: 1500000,
                            details: [
                                { detailId: 1, product_name: "Bóng đá", option_id: "Size 5", option_quantity: 10, option_cost: 100000 },
                                { detailId: 2, product_name: "Áo thể thao", option_id: "M", option_quantity: 5, option_cost: 50000 }
                            ]
                        },
                        {
                            bill_supply_id: "PN002",
                            supplier_name: "Công ty B",
                            supplier_phone: "0912345678",
                            supplier_address: "456 Nguyễn Trãi",
                            bill_supply_date: "2024-12-10",
                            bill_supply_cost: 3200000,
                            details: [
                                { product_name: "Găng tay", option_id: "L", option_quantity: 20, option_cost: 80000 }
                            ]
                        }
                    ];

                    // Giả sử đây là dữ liệu mẫu sản phẩm từ server hoặc sẵn có
                    const productOptionsData = {
                        "SP001": [
                            {
                                option_id: "OP001",
                                size: "M",
                                quantity: 10,
                                cost: 150000,
                                discount_id: 1,
                                color_id: 1,
                                color_name: "Đỏ",
                                is_active: true
                            },
                            {
                                option_id: "OP002",
                                size: "L",
                                quantity: 5,
                                cost: 155000,
                                discount_id: 1,
                                color_id: 2,
                                color_name: "Xanh",
                                is_active: false
                            }
                        ],
                        "SP002": [
                            {
                                option_id: "OP003",
                                size: "S",
                                quantity: 8,
                                cost: 120000,
                                discount_id: 2,
                                color_id: 3,
                                color_name: "Trắng",
                                is_active: true
                            }
                        ]
                    };


                    $("#nav-sanpham").on("click", e => {
                        e.preventDefault();
                        $(".main-content").hide();
                        $("#sanpham-content").show();
                    });


                    $(document).ready(function() {
                        // Lắng nghe sự kiện click vào dòng sản phẩm trong bảng
                        $('#product-list').on('click', 'tr', function () {
                            const productId = $(this).data('product-id');
                            const options = productOptionsData[productId] || [];

                            // Ẩn phần content trước đó (nếu cần thiết)
                            // Ẩn các phần content khác


                            $("#sanpham-content").hide();

                            // Hiện bảng mẫu sản phẩm
                            $('#product-option-content').show();
                            // Hiển thị bảng tùy chọn cho sản phẩm
                            displayProductOptions(productId);  // Gọi hàm hiển thị chi tiết sản phẩm

                        });

                    });

                    function searchDetailBill() {
                        const keyword = document.getElementById("search-bill-detail").value.trim().toLowerCase();
                        const rows = document.querySelectorAll("#bill-detail-body tr");

                        rows.forEach(row => {
                            const productName = row.cells[0].textContent.toLowerCase(); // Tên sản phẩm
                            const optionId = row.cells[1].textContent.toLowerCase();    // Phân loại

                            if (productName.includes(keyword) || optionId.includes(keyword)) {
                                row.style.display = "";
                            } else {
                                row.style.display = "none";
                            }
                        });
                    }

                    document.getElementById("search-bill-detail").addEventListener("keydown", function (e) {
                        if (e.key === "Enter") {
                            searchDetailBill();
                        }
                    });


                    function displayProductOptions(productId) {
                        const options = productOptionsData[productId] || [];
                        const tbody = document.querySelector('#productOptionTable tbody');
                        const container = document.getElementById("product-option-content");

                        tbody.innerHTML = '';

                        options.forEach(option => {
                            const row = document.createElement('tr');
                            row.innerHTML = `
            <td>${option.option_id}</td>
            <td>${option.color_name || "Không rõ"}</td>
            <td>${option.size}</td>
            <td>${option.quantity}</td>
            <td>${option.cost.toLocaleString()}₫</td>
            <td>${option.discount_id}</td>
            <td><img src="img/placeholder.jpg" width="50" alt="Ảnh mẫu"></td>
            <td><input type="checkbox" ${option.is_active ? 'checked' : ''}></td>
        `;
                            tbody.appendChild(row);
                        });

                        $(".main-content").hide(); // ẩn hết
                        container.style.display = "block"; // hiện bảng mẫu
                    }

                    function openAddColorModal() {
                        $('#addColorModal').modal('show');
                    }

                    document.getElementById('addColorForm').addEventListener('submit', function (e) {
                        e.preventDefault();
                        const id = document.getElementById('newColorId').value;
                        const name = document.getElementById('newColorName').value;

                        const select = document.getElementById('newOptionColor');
                        const option = document.createElement('option');
                        option.value = id;
                        option.textContent = name;

                        // Chèn trước dòng "Thêm màu mới"
                        select.insertBefore(option, select.querySelector('option[value="add_new"]'));

                        // Tự chọn màu vừa thêm
                        select.value = id;

                        $('#addColorModal').modal('hide');
                        this.reset();
                    });


                    document.getElementById('newOptionImage').addEventListener('change', function (e) {
                        const preview = document.getElementById('imagePreview');
                        preview.innerHTML = ''; // Xóa hình cũ (nếu có)

                        const files = Array.from(e.target.files);
                        files.forEach(file => {
                            const reader = new FileReader();
                            reader.onload = function (e) {
                                const img = document.createElement('img');
                                img.src = e.target.result;
                                img.style.width = '80px';
                                img.style.height = '80px';
                                img.style.objectFit = 'cover';
                                img.style.margin = '5px';
                                img.classList.add('img-thumbnail');
                                preview.appendChild(img);
                            };
                            reader.readAsDataURL(file);
                        });
                    });

                    // Xử lý sự kiện khi gửi form thêm mới product_option
                    document.getElementById('productOptionForm').addEventListener('submit', function(event) {
                        event.preventDefault();

                        const newOption = {
                            option_id: document.getElementById('newOptionId').value,
                            option_color: document.getElementById('newOptionColor').value,
                            option_size: document.getElementById('newOptionSize').value,
                            option_quantity: document.getElementById('newOptionQuantity').value,
                            option_cost: document.getElementById('newOptionPrice').value
                        };

                        const productId = "SP001"; // Bạn có thể thay đổi theo sản phẩm cụ thể
                        if (!productOptionsData[productId]) {
                            productOptionsData[productId] = [];
                        }
                        productOptionsData[productId].push(newOption);

                        // Cập nhật lại bảng hiển thị product_option
                        displayProductOptions(productId);

                        // Ẩn form thêm sản phẩm
                        document.getElementById('addOptionForm').style.display = 'none';
                    });

                    const products = [
                        {
                            product_id: "SP001",
                            product_name: "Bóng chuyền",
                            category_id: "CAT01",
                            brand_id: "BR01",
                            discount_id: "DC01",
                            product_detail: "Bóng chuyên dùng cho thi đấu trong nhà.",
                            is_active: 1
                        },
                        {
                            product_id: "SP002",
                            product_name: "Áo thể thao nam",
                            category_id: "CAT02",
                            brand_id: "BR02",
                            discount_id: null,
                            product_detail: "Chất liệu cotton, thấm hút mồ hôi.",
                            is_active: 0
                        }
                    ];
                    function renderProductList() {
                        const tbody = $('#product-list');
                        tbody.empty(); // Xóa các dòng cũ trong bảng

                        products.forEach(product => {
                            const row = `
            <tr data-product-id="${product.product_id}">
                <td>${product.product_id}</td>
                <td>${product.product_name}</td>
                <td>${product.category_id}</td>
                <td>${product.brand_id}</td>
                <td>${product.discount_id ? product.discount_id : "Không có"}</td>
                <td>${product.is_active ? '<span class="badge badge-success">Đang bán</span>' : '<span class="badge badge-danger">Ngừng</span>'}</td>
                <td>${product.product_detail}</td>
            </tr>
        `;
                            tbody.append(row); // Thêm dòng vào bảng
                        });
                    }

                    // Gọi hàm renderProductList khi trang được tải


                    let categories = ["CAT01", "CAT02"];
                    let brands = ["BR01", "BR02"];
                    let discounts = ["DC01", "DC02"];

                    function formatCurrency(number) {
                        return number.toLocaleString('vi-VN') + ' đ';
                    }
                    function searchProduct() {
                        const keyword = document.getElementById("search-product-keyword").value.toLowerCase();
                        const filtered = products.filter(p =>
                            p.product_id.toLowerCase().includes(keyword) ||
                            p.product_name.toLowerCase().includes(keyword)
                        );
                        loadProducts(filtered);
                    }

                    function loadBills(data = bills) {
                        const tbody = document.getElementById("bill-supply-list");
                        tbody.innerHTML = "";
                        let total = 0;
                        data.forEach(b => {
                            total += b.bill_supply_cost;
                            tbody.innerHTML += `
                <tr>
                    <td><a href="#" class="text-primary font-weight-bold">${b.bill_supply_id}</a></td>
                    <td>${b.supplier_name}</td>
                    <td>${b.supplier_phone}</td>
                    <td>${b.supplier_address}</td>
                    <td>${b.bill_supply_date}</td>
                    <td><span class="badge badge-success">Hoàn thành</span></td>
                    <td class="text-right">${formatCurrency(b.bill_supply_cost)}</td>
                    <td><button class="btn btn-info btn-sm" onclick="viewDetail('${b.bill_supply_id}')">Xem</button></td>
                </tr>
            `;
                        });
                        document.getElementById("total-bills").textContent = data.length;
                        document.getElementById("total-cost").textContent = formatCurrency(total);
                    }

                    function searchBill() {
                        const keyword = document.getElementById("search-keyword").value.toLowerCase();
                        const filtered = bills.filter(b =>
                            b.bill_supply_id.toLowerCase().includes(keyword) ||
                            b.supplier_name.toLowerCase().includes(keyword)
                        );
                        loadBills(filtered);
                    }
                    function searchProductOption() {
                        const keyword = document.getElementById("search-product_option-keyword").value.trim().toLowerCase();
                        const table = document.getElementById("productOptionTable");
                        const rows = table.getElementsByTagName("tbody")[0].getElementsByTagName("tr");

                        for (let i = 0; i < rows.length; i++) {
                            const optionId = rows[i].cells[0].textContent.toLowerCase();
                            const color = rows[i].cells[1].textContent.toLowerCase();

                            if (optionId.includes(keyword) || color.includes(keyword)) {
                                rows[i].style.display = "";
                            } else {
                                rows[i].style.display = "none";
                            }
                        }
                    }
                    document.getElementById("search-product_option-keyword").addEventListener("keydown", function(e) {
                        if (e.key === "Enter") {
                            searchProductOption();
                        }
                    });
                    function viewDetail(id) {
                        const bill = bills.find(b => b.bill_supply_id === id);
                        document.getElementById("selected-bill-id").textContent = bill.bill_supply_id;

                        const tbody = document.getElementById("bill-detail-body");
                        tbody.innerHTML = "";

                        bill.details.forEach(d => {
                            const total = d.option_quantity * d.option_cost;
                            tbody.innerHTML += `
            <tr>
                <td>${d.detailId}</td>
                <td>${d.product_name}</td>
                <td>${d.option_id}</td>
                <td>${d.option_quantity}</td>
                <td>${formatCurrency(d.option_cost)}</td>
                <td>${formatCurrency(total)}</td>
            </tr>
        `;
                        });

                        // Ẩn danh sách phiếu nhập
                        document.getElementById("nhapkho-content").style.display = "none";

                        // Hiện chi tiết phiếu nhập
                        document.getElementById("bill-detail-section").style.display = "block";
                    }


                    function loadProducts() {
                        const tbody = document.getElementById("product-list");
                        tbody.innerHTML = "";
                        products.forEach(p => {
                            tbody.innerHTML += `
            <tr data-product-id="${p.product_id}">
                <td>${p.product_id}</td>
                <td>${p.product_name}</td>
                <td>${p.category_id}</td>
                <td>${p.brand_id}</td>
                <td>${p.discount_id ?? '-'}</td>
                <td>
                    <span class="badge ${p.is_active === 1 ? 'badge-success' : 'badge-danger'}">
                        ${p.is_active === 1 ? 'Đang bán' : 'Ngừng bán'}
                    </span>
                </td>
                <td>${p.product_detail}</td>
            </tr>
        `;
                        });
                    }


                    document.getElementById("bill-form").addEventListener("submit", function (e) {
                        e.preventDefault();
                        const newBill = {
                            bill_supply_id: document.getElementById("bill_id").value,
                            supplier_name: document.getElementById("supplier_name").value,
                            supplier_phone: document.getElementById("supplier_phone").value,
                            supplier_address: document.getElementById("supplier_address").value,
                            bill_supply_date: document.getElementById("bill_date").value,
                            bill_supply_cost: parseInt(document.getElementById("bill_cost").value),
                            details: []
                        };
                        bills.push(newBill);
                        loadBills();
                        $('#addBillModal').modal('hide');
                        this.reset();
                        alert("Đã thêm phiếu nhập mới!");
                    });

                    document.getElementById("bill-detail-form").addEventListener("submit", function (e) {
                        e.preventDefault();
                        const billId = document.getElementById("selected-bill-id").textContent;
                        const bill = bills.find(b => b.bill_supply_id === billId);
                        if (!bill) {
                            alert("Vui lòng chọn hóa đơn để thêm chi tiết.");
                            return;
                        }

                        const detail = {
                            product_name: document.getElementById("detail_product_name").value,
                            option_id: document.getElementById("detail_option_id").value,
                            option_quantity: parseInt(document.getElementById("detail_quantity").value),
                            option_cost: parseInt(document.getElementById("detail_cost").value)
                        };

                        bill.details.push(detail);
                        viewDetail(billId); // cập nhật chi tiết hiển thị

                        $('#addBillDetailModal').modal('hide');
                        this.reset();
                        alert("Đã thêm chi tiết phiếu nhập!");
                    });

                    function populateSelect(id, list, label) {
                        const select = document.getElementById(id);
                        select.innerHTML = list.map(val => `<option value="${val}">${val}</option>`).join('');
                        select.innerHTML += `<option value="__add__">➕ Thêm ${label} mới</option>`;
                    }


                    function handleAddOption(type) {
                        const select = document.getElementById(`${type}_id`);
                        const value = select.value;

                        if (value === "__add__") {
                            // Reset lại input trong modal
                            if (type === 'category') {
                                document.getElementById("new_category_name").value = "";
                                $('#addCategoryModal').modal('show');
                            } else if (type === 'brand') {
                                document.getElementById("new_brand_name").value = "";
                                $('#addBrandModal').modal('show');
                            }

                            // Reset dropdown về giá trị đầu tiên để tránh giữ “__add__”
                            select.selectedIndex = 0;
                        }
                    }

                    // Xử lý lưu loại sản phẩm mới
                    document.getElementById("category-form").addEventListener("submit", function (e) {
                        e.preventDefault();
                        const name = document.getElementById("new_category_name").value.trim();
                        if (name !== "") {
                            const select = document.getElementById("category_id");
                            const option = document.createElement("option");
                            option.text = name;
                            option.value = "new_" + Date.now(); // Gán tạm ID
                            select.add(option, select.options.length - 1); // Thêm trước dòng “+ Thêm loại mới”
                            select.value = option.value; // Set lại giá trị đã chọn
                            $('#addCategoryModal').modal('hide');
                        }
                    });

                    // Xử lý lưu thương hiệu mới
                    document.getElementById("brand-form").addEventListener("submit", function (e) {
                        e.preventDefault();
                        const name = document.getElementById("new_brand_name").value.trim();
                        if (name !== "") {
                            const select = document.getElementById("brand_id");
                            const option = document.createElement("option");
                            option.text = name;
                            option.value = "new_" + Date.now();
                            select.add(option, select.options.length - 1);
                            select.value = option.value;
                            $('#addBrandModal').modal('hide');
                        }
                    });

                    function deleteSelectedOption(selectId) {
                        const select = document.getElementById(selectId);
                        const selectedOption = select.options[select.selectedIndex];
                        
                        if (selectedOption && selectedOption.value !== "" && selectedOption.value !== "__add__") {
                            if (confirm(`Bạn có chắc muốn xóa "${selectedOption.text}"?`)) {
                                select.remove(select.selectedIndex);
                                alert("Đã xóa thành công!");
                            }
                        } else {
                            alert("Vui lòng chọn một mục để xóa!");
                        }
                    }

                    function deleteSelectedColor() {
                        const select = document.getElementById('newOptionColor');
                        const selectedOption = select.options[select.selectedIndex];
                        
                        if (selectedOption && selectedOption.value !== "" && selectedOption.value !== "add_new") {
                            if (confirm(`Bạn có chắc muốn xóa màu "${selectedOption.text}"?`)) {
                                select.remove(select.selectedIndex);
                                alert("Đã xóa màu thành công!");
                            }
                        } else {
                            alert("Vui lòng chọn một màu để xóa!");
                        }
                    }

                    function toggleAddBill() {
                        $('#addBillModal').modal('show');
                    }
                    function toggleAddDetailBill() {
                        $('#addBillDetailModal').modal('show');
                    }
                    document.getElementById("product-form")?.addEventListener("submit", function (e) {
                        e.preventDefault();
                        const newProduct = {
                            product_id: document.getElementById("product_id").value,
                            product_name: document.getElementById("product_name").value,
                            product_detail: document.getElementById("product_detail").value,
                            category_id: document.getElementById("category_id").value,
                            brand_id: document.getElementById("brand_id").value,
                            discount_id: document.getElementById("discount_id").value,
                            is_active: document.getElementById("is_active").checked ? 1 : 0
                        };
                        products.push(newProduct);
                        loadProducts();
                        alert("Đã thêm sản phẩm mới!");
                        this.reset();
                        document.getElementById("is_active").checked = true;
                    });

                    document.addEventListener("DOMContentLoaded", () => {
                        loadBills();
                        loadProducts();
                        populateSelect("category_id", categories, "loại");
                        populateSelect("brand_id", brands, "thương hiệu");
                        populateSelect("discount_id", discounts, "giảm giá");

                        $(".main-content").hide();
                        $("#dashboard-content").show();

                        $("#nav-nhapkho").on("click", e => {
                            e.preventDefault();
                            $(".main-content").hide();
                            $("#nhapkho-content").show();
                            $("#bill-detail-section").hide();
                        });

                        $("#nav-dashboard").on("click", e => {
                            e.preventDefault();
                            $(".main-content").hide();
                            $("#dashboard-content").show();
                        });

                        $("#nav-sanpham").on("click", e => {
                            e.preventDefault();
                            $(".main-content").hide();
                            $("#sanpham-content").show();
                        });

                        document.getElementById("product-form")?.addEventListener("submit", function (e) {
                            e.preventDefault();
                            const newProduct = {
                                product_id: document.getElementById("product_id").value,
                                product_name: document.getElementById("product_name").value,
                                product_detail: document.getElementById("product_detail").value,
                                category_id: document.getElementById("category_id").value,
                                brand_id: document.getElementById("brand_id").value,
                                discount_id: document.getElementById("discount_id").value,
                                is_active: document.getElementById("is_active").checked ? 1 : 0
                            };
                            products.push(newProduct);
                            loadProducts();
                            alert("Đã thêm sản phẩm mới!");
                            this.reset();
                            document.getElementById("is_active").checked = true;

                            $('#addProductModal').modal('hide'); // <--- Ẩn modal sau khi thêm
                        });


                    });
                </script>
</body>
</html>
